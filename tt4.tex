\documentclass[10pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage{amssymb,amstext,amsmath}
\usepackage{mathpartir}
\usepackage{mytheorems}
\usepackage[a4paper,margin=1.8cm]{geometry}
\usepackage{fancyref}

\newcommand\CC[4]{(#2,_{#1} #3)}
\newcommand\CP[3]{(#2,_{#1} #3)}
\newcommand\CSig[1]{\Sigma^{#1}}
\newcommand\CTimes[3]{#2 ×_{#1} #3}
\newcommand\SW[2]{\mathsf{SW}^{#1}_{#2}}
\newcommand\sw[2]{\mathsf{sw}^{#1}_{#2}}
\newcommand\dom{\mathsf{dom}}
\newcommand\param[1]{\!\cdot\!#1}
\newcommand\pvar[2]{{#1}^{(#2)}}
\newcommand\op[1]{∋_{#1}}
\newcommand\ip[3]{Σ^{#1} {#2}\,{#3}}
\newcommand\fp[3]{⟨#2 ,_{#1} #3⟩}
\newcommand\proj[2]{⌊{#2}⌋_{#1}}


\input{unicodedefs}

\title{A parametric Type theory}

\author{}
\date{\today}

\begin{document}
\maketitle


\begin{definition}[Syntax of terms and contexts]
  
  \begin{align*}
    t,u,A,B & ::= x ~|~ U ~|~ λx:A. t      ~|~ t u ~|~ (x:A) → B \\
            & ~|~ \CP i t u  ~|~ \ip i A B  ~|~ \fp i t u \\
            & ~|~ A \op i u ~|~ t \param i  \\
    \Gamma,\Delta & ::= () ~|~ \Gamma,x:A
  \end{align*}
\end{definition}

We use $I,J,…$ for finite {\em sets} of colours (order does not matter).

\begin{definition}[Typing relation]
Contexts:
  \begin{mathpar}
    \inferrule[Empty]{~}{() ⊢ }

    \inferrule[NewVar]{Γ⊢ \\ Γ ⊢_I A : U }{ Γ,x:A ⊢ }

  \end{mathpar}
 
Types:
 \begin{mathpar}
    \inferrule[Universe]{Γ ⊢}{Γ ⊢_I U : U}

    \inferrule[Pi]{Γ ⊢_I A : U \\ Γ,x:A ⊢_I B : U}{Γ ⊢_I (x:A) → B : U}

    \inferrule[Out]{Γ ⊢_I T : U \\ Γ ⊢_I a : T}{Γ ⊢_I T \op i  a : U}

    \inferrule[In-Pred]{Γ ⊢_{I} A : U \\ Γ ⊢_{I} P : A → U}{Γ ⊢_{I,i} \ip i A P : U}

 \end{mathpar}

Terms:
  \begin{mathpar}
    \inferrule[Conv]{Γ ⊢_I t:A \\ A = B}{Γ ⊢_I t : B}

    \inferrule[Var]{Γ ⊢_I A : U}{Γ,x:A ⊢_I x : A}

    \inferrule[Wk]{Γ ⊢_I A \\Γ ⊢_I t : T}{Γ,x:A ⊢_I t : T}

    \\\inferrule[Lam]{Γ,x:A ⊢_I B}{Γ ⊢_I λx:A.b : (x:A) → B}
 
    \inferrule[App]{Γ ⊢_I t : (x:A) → B[x] \\ Γ ⊢_I u : A}{Γ ⊢_I t u: B[u]}

    \\\inferrule[In-Abs]{Γ ⊢_I a : \proj i T \\Γ ⊢_I p : T \op i a}{Γ ⊢_{I,i} \CP i a p : T}

    \inferrule[In-Fun]
        {Γ ⊢_I f : (x:A) → P x\\\\
        Γ ⊢_I g : (x:A) → (x':A \op i x) → P \CP i x {x'} \op i f x}{Γ ⊢_{I,i} \fp i f g : (x:A) → P x}

    \inferrule[Color-elim]{Γ ⊢_{I,i} a : T}{Γ ⊢_I a \param i : T \op i {\proj i a}}


  \end{mathpar}
\end{definition}

\begin{definition}[Projection]~
  $\proj i \cdot$ is a (partial) meta-operation on the raw syntax.
  \begin{align*}
  \proj i {\fp i f g} & = f \\
  \proj i {(a,_i p)} &= a \\
  \proj i {\ip i A P} &= A \\
  \proj i {T \op i a} &= \proj i T
\end{align*}

+ congruences.
\end{definition}



\begin{definition}[Reduction]~

β:
\begin{align*}
  (λx:A. u[x]) t &= u[t]
\end{align*}

Swaps:
\begin{align*}
  a \param i \param j &= a \param j \param i \\
  T \op i \CP j a b \op j c &= T \op j \CP i a c \op i b
\end{align*}
Note: the above rule shows why ${} \param i {}$ is different from $\op i {}$.
$T$ must be of the form $(\ip {i₀} A P) \op {i₁} {a₁} … \op {i_n} {a_n}$

Pair-like things:
\begin{align*}
  {\fp i f g} \, a & = (f\,{\proj i a} ,_i g\,{\proj i a}\,{(a \param i)}) \\
  {(a,_i p)} \param i  &= p \\
  {(\ip i A P)} \op i a &= P\,a
\end{align*}

Note: the param-witness construction is bootstrapped by the last rule.

\end{definition}

Confluence implies other equalities, such as:
\begin{align*}
  {(a,_j p)} \param i  &= (a \param i ,_j p \param i) \\
  {(\ip j A P)} \op i a &= \ip j {(A \op i {\proj i a})} {(λy. P \, \CP i {\proj i a} y \op i {(a \param j)})}
\end{align*}

\begin{definition}[Conversion]
  \begin{mathpar}
    \inferrule{t x = u} {t = λ x:A.u}

    \inferrule{\proj i t = a \\ t \param i = p} {t = \CP i a p }
  \end{mathpar}
+ congruences.
\end{definition}



\end{document}
