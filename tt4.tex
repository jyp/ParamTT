\documentclass[english]{PaperTools/latex/lipics}
\graphicspath{{PaperTools/latex/}}
\usepackage{natbib}
\usepackage[utf8]{inputenc}
\usepackage{stmaryrd}
\usepackage{amssymb,amstext,amsmath}
\usepackage{mathtools}
\usepackage{mathpartir}
\usepackage{fancyref}

\usepackage{tikz}
\usetikzlibrary{arrows}

\newcommand\CC[4]{(#2,_{#1} #3)}
\newcommand\CP[3]{(#2,_{#1} #3)}
\newcommand\CSig[1]{\Sigma^{#1}}
\newcommand\CTimes[3]{#2 ×_{#1} #3}
\newcommand\SW[2]{\mathsf{SW}^{#1}_{#2}}
\newcommand\sw[2]{\mathsf{sw}^{#1}_{#2}}
\newcommand\dom{\mathsf{dom}}
\newcommand\param[1]{\!\cdot\!#1}
\newcommand\pvar[2]{{#1}^{(#2)}}
\newcommand\op[1]{∋_{#1}}
\newcommand\ip[3]{Σ^{#1} {#2}\,{#3}}
\newcommand\fp[3]{⟨#2 ,_{#1} #3⟩}
\newcommand\mor[2]{{#1}\,{#2}}
\newcommand\proj[2]{\mor{#2}{(#1\,0)}}
\newcommand\projp[2]{\proj{#1}{(#2)}}

\newcommand\comment[1]{}
\input{unicodedefs}

\def\pI{\ensuremath{\mathbf{pI}}}
\def\fresh#1{\mathsf{fresh}(#1)}
\def\Hom#1#2{\mathbf{Hom}(#1,#2)}
\def\ie{\textit{i.e.}}
\def\app#1#2{\mathsf{app}(#1,#2)}

\title{A presheaf model of parametric type-theory}

\author{}
\date{\today}

\begin{document}
\maketitle

\begin{abstract}
  We propose a new intentional type-theory with internalized
  parametricity. Compared to previous similar proposals, this version
  comes with a denotational semantics, which is a refinement of the
  standard presheaf semantics for categories with families.
  This calculus also introduces few syntatic constructs elements, making
  it a better candidate for the core of a proof assistant.
\end{abstract}

\section{Syntax}
In the following section we define the syntax and typing-rules of our
parametric type-theory, as well as the equality judgement.

\begin{definition}[Syntax of terms and contexts]
  \begin{align*}
    t,u,A,B & \coloneqq x \mid U \mid λx:A. t      \mid t u \mid (x:A) → B \\
            & \mid \CP i t u  \mid \ip i A B  \mid \fp i t u \\
            & \mid A \op i u \mid t \param i  \\
    \Gamma,\Delta & \coloneqq () \mid \Gamma,x:A
  \end{align*}
\end{definition}

%We consider a total order $\preccurlyeq$ on colours (for uniqueness of normal forms).
We use $I,J,…$ for finite sets of colours.

\begin{definition}[Typing relation]
Contexts:
  \begin{mathpar}
    \inferrule[Empty]{~}{() ⊢_I }

    \inferrule[NewVar]{Γ⊢_I \\ Γ ⊢_I A : U }{ Γ,x:A ⊢_I }

  \end{mathpar}
 
Types:
 \begin{mathpar}
    \inferrule[Universe]{Γ ⊢}{Γ ⊢_I U : U}

    \inferrule[Pi]{Γ ⊢_I A : U \\ Γ,x:A ⊢_I B : U}{Γ ⊢_I (x:A) → B : U}

    \inferrule[Out]{Γ ⊢_{I,i} T : U \\ Γ ⊢_I a : \proj i T}{Γ ⊢_I T \op i  a : U}

    \inferrule[In-Pred]{Γ ⊢_{I} A : U \\ Γ ⊢_{I} P : A → U}{Γ ⊢_{I,i} \ip i A P : U}

 \end{mathpar}

Terms:
  \begin{mathpar}
    \inferrule[Conv]{Γ ⊢_I t:A \\ A = B}{Γ ⊢_I t : B}

    \inferrule[Var]{Γ ⊢_I \\ x : A ∈ Γ}{Γ ⊢_I x : A}


    \\\inferrule[Lam]{Γ,x:A ⊢_I B}{Γ ⊢_I λx:A.b : (x:A) → B}
 
    \inferrule[App]{Γ ⊢_I t : (x:A) → B[x] \\ Γ ⊢_I u : A}{Γ ⊢_I t u: B[u]}

    \\\inferrule[In-Abs]{Γ ⊢_I a : \proj i T \\Γ ⊢_I p : T \op i a}{Γ ⊢_{I,i} \CP i a p : T}

    \inferrule[In-Fun]
        {Γ ⊢_I f : \projp i {(x:A) → P x}\\\\
        Γ ⊢_I g : (x:\proj i A) → (x':A \op i x) → P \CP i x {x'} \op i f x}{Γ ⊢_{I,i} \fp i f g : (x:A) → P x}

    \inferrule[Color-elim]{Γ ⊢_{I,i} a : T}{Γ ⊢_I a \param i : T \op i {\proj i a}}


  \end{mathpar}
\end{definition}

Notes:

\begin{itemize}
\item We collapse the universe hierarchy for conciseness, but
  supporting it is orthogonal to the specific features of this system.
\item If one wishes to define a function depending usefully on a colored type
  need to use the {\sc In-Fun} rule.
\end{itemize}

\begin{definition}[Morphism application]~
  We consider partial injections $f : I → J$ and for any $I$-term $a$,
  we define the $J$-term $af$ by structural induction on $a$.
  We note $(ι\,0) : I,ι → I$ the partial identity.
\begin{align*}
  x f & = x \\
  U f & = U \\
  (λ(x:A).t) f &= λ(x:Af).tf \\
  (t\,u) f &= (tf) \, (uf) \\
  ((x:A)→B) f &= (x:Af)→(Bf) \\
  \CP {ι} a p f &= \CP {κ} {ag} {pg}
    & \text{if $fι = κ$, $g : I→J_κ$ such that $(ι\,0)g = f(κ\,0) : I,ι → J_κ$} \\
                &= ag
    & \text{if $∃g : I→J$ such that $f = (ι\,0)g : I,ι → J$} \\
  (\ip {ι} A P) f &= \ip {κ} {(Ag)} {(Pg)}
    & \text{if $fι = κ$, $g : I→J_κ$ such that $(ι\,0)g = f(κ\,0) : I,ι → J_κ$} \\
                &= Ag
    & \text{if $∃g : I→J$ such that $f = (ι\,0)g : I,ι → J$} \\
  \fp {ι} u v f &= \fp {κ} {ug} {vg}
    & \text{if $fι = κ$, $g : I→J_κ$ such that $(ι\,0)g = f(κ\,0) : I,ι → J_κ$} \\
                &= ug
    & \text{if $∃g : I→J$ such that $f = (ι\,0)g : I,ι → J$} \\
  A \op {ι} a &= (Ag) \op {κ} (af)
    & \text{where $κ = \fresh J$ and $g:I,ι → J,κ$ satisfies $(ι\,0)f = g(κ\,0)$} \\
  (a · ι) f &= (ag) · κ
    & \text{where $κ = \fresh J$ and $g:I,ι → J,κ$ satisfies $(ι\,0)f = g(κ\,0)$}
\end{align*}
  (We remark that for any $f : I,ι → J,κ$ with $fι=κ$, there is a
  unique $g : I → J$ such that $(ι\,0)g = f(κ\,0) : I,ι → J$;
  and that for any $f : I,ι → J$ which is not defined on $ι$, there is
  a unique $g : I → J$ such that $(ι\,0)g = f$.)

  We have $a1 = a$ and $(af)g = a(fg)$ for any $g : J → K$.
  Furthermore, if $Γ ⊢_I a : A$ then $Γ f ⊢_J af : Af$ (proof by
  induction on the typing judgement).
\end{definition}


\comment{
\begin{definition}[Normal forms and neutral terms]~
  \begin{align*}
    \mathsf{Nf} ∋ u,v,A,B & \coloneqq
      U \mid λx:A. t \mid (x:A) → B \\
      & \mid \CP i u v \mid \fp i u v \\
      & \mid {(\ip {i₀} A B)} \op {i₁} {u_1 \cdots} \op {i_n} {u_n} &\quad \text{($i₀ \prec i₁ \prec \ldots \prec i_n$)} \\
      & \mid s \param {i₀} \cdots \param {i_{n-1}}                  &\quad \text{($i₀ \prec   < \ldots \prec i_{n-1}$)}
    \\
    \mathsf{Ne} ∋ s & \coloneqq x \mid s \, u
  \end{align*}
\end{definition}
}
\begin{definition}[Conversion]~

β:
\begin{align*}
  (λx:A. u[x]) t &= u[t]
\end{align*}

Pair-like things:
\begin{align*}
  {\fp i f g} \, a      &= (f\,{\proj i a} ,_i g\,{\proj i a}\,{(a \param i)}) \\
  {(a,_i p)} \param i   &= p \\
  {(\ip i A P)} \op i a &= P\,a
\end{align*}

Note: the param-witness construction is bootstrapped by the last rule.

  \begin{mathpar}
    \inferrule{t x = u} {t = λ x:A.u}
    \and
    \inferrule{\proj i t = a \\ t \param i = p} {t = \CP i a p }
    \and
    \inferrule{\proj i t = f \\ (t \CP i x y) \param i = g x y} {t = \fp i f g }
    \and
    \inferrule{\proj i T = A \\ T \op i x = P x} {T = \CSig i A P }
    \and
    \inferrule{~}{a = a}
    \and
    \inferrule{a = b}{b = a}
    \and
    \inferrule{a = b \\ b = c}{a = c}
  \end{mathpar}
  + congruences
\end{definition}

\paragraph{Consequences}
\begin{corollary}~
  \begin{itemize}
  \item $a = \CP i {\proj i a} {a \param i}$
  \item $T = \CSig i {\proj i T} {(λx. T \op i x)}$
  \item $f = \fp i {\proj i f} {λx x'. (f \CP i x {x'}) \param i}$
  \end{itemize}
\end{corollary}

\section{Iterating Parametricity}
For any type $A$ (which may not depend on any color), we have
\begin{align*}
p &: (x:A) → A \op i x\\
p x &= x\param i\\
q &: (x:A) → (A \op i x) \op j x \param  i\\
  &: (x:A) → (A \op j \CP i x {x \param j}) \op j x \param  i\\
q x &= x\param i\param j
\end{align*}

If $A$ were to depend on a color, the types would not be well-formed:
types put in an environment must have no free color ({\sc New-Var}).

\section{Isomorphisms}


\begin{theorem}
$U \op i A$ is definitionally isomorphic to $A → U$.
\end{theorem}
\begin{proof}~
  \begin{enumerate}
  \item Assume $Q : U \op i A$. Then $P : A → U$ if $P x = \CP i A Q \op i x$.
  \item Assume $P : A → U$. Then $Q : U \op i A$ if $Q = (\CSig i A P) \param i$.
  \item Check 1: $\CP i A {(\CSig i A P) \param i} \op i x = (\CSig i A P) \op i x = P x$
  \item Check 2: $(\CSig i A {λx. \CP i A Q \op i x}).i = Q$ iff $\CSig i A {λx. \CP i A Q \op i x} = \CP i A Q$. We use conversion for $\Sigma$. The first components are obviously equal. For the second components we are left with $\CP i A Q \op i x = \CP i A Q \op i x$, which is obvious.
  \end{enumerate}
\end{proof}

\begin{theorem}
$((x:A) → B[x]) \op i f$ is definitionally isomorphic to $(x:A) → (x' : A \op i x) → B[\CP i x {x'}] \op i (f x)$.
\end{theorem}
\begin{proof}~
  \item Assume $q : ((x:A) → B[x]) \op i f$. Then $p : (x:A) → (x' : A \op i x) → B[\CP i x {x'}] \op i (f x)$ if $p x x' = (\CP i f q \CP i x {x'}) \param i$.
  \item Assume $p : (x:A) → (x' : A \op i x) → B[\CP i x {x'}] \op i (f x)$ Then $q : ((x:A) → B[x]) \op i f$ if $q = \fp i f p \param i$.
  \item Check 1: $(\CP i f {\fp i f p \param i} \CP i x x') \param i = ({\fp i f p} \CP i x {x'}) \param i = \CP i {f x} {p x x'} \param i = p x x' $
  \item Check 2: $\fp i f {λx x'. (\CP i f q \CP i x {x'}) \param i} \param i$ iff $\fp i f {λx x'. (\CP i f q \CP i x {x'}) \param i} = \CP i f q$, which is true by conversion of function pairing.
\end{proof}
\section{Link with "Old" parametricity (2)}
We define a (unary) relational interpretation of types $⟦A⟧$. This
interpretation coincides with the usual relational interpretation of types.
We show that, if $⟦·⟧$ and $∋_i$ are equivalent for free type variables,
then they are equivalent for every type in normal form.

\begin{definition}
We define $⟦A⟧$ by structural induction on $A$.
  \begin{align*}
    ⟦A → B⟧ f & = (x:\proj i A) → ⟦A⟧ x → ⟦B⟧ (f x)\\
    ⟦U⟧ A & = A → U\\
    ⟦A \op j a ⟧ b &= ⟦A⟧ \CP j {\proj i a} b \op j a \param i \\
    ⟦\ip i A P⟧ x & = P x\\
    ⟦x⟧ a & = x \op i a
  \end{align*}
\end{definition}

\providecommand\TO{\overrightarrow}
\providecommand\FROM{\overleftarrow}

\begin{theorem}
For every type $A$, $A \op i x$ is provable iff. $⟦A⟧ x$ is provable.
\end{theorem}
Let us call $\TO A$ the conversion from $A \op i x$ to $⟦A⟧ x$; and $\FROM A$ the other direction.
\begin{proof}
  By structural induction on $A$. Key cases:
  \begin{itemize}
  \item Pi.
    Assume:
    \begin{itemize}
    \item $f : A → B$
    \item $p : (A → B) \op i f$
    \end{itemize}
    We prove $q : (x:\proj i A) → ⟦A⟧ x → ⟦B⟧ (f x)$ with $q x x' = \TO {B[\CP i x {\FROM A x'}]} ((\CP i f
    p \CP i x {\FROM A x'}) \param i)$.

    Right to left: $p = (\fp i f {λx. λx'. \FROM {B[\CP i x {x'}]} (q x (\TO A x'))}) \param i $

    (No need to carry around an environment; the proof given by the
    user ($x'$) is substituted in terms --- the substitutions are
    well-typed, given the {\sc In-Abs} rule.)

  \item Universe.

    Left to right. Assume:
    \begin{itemize}
    \item $A : U$
    \item $P : U \op i A $
    \end{itemize}
    We prove $Q : A → U$ with $Q x = \CP i A P \op i x$.
 

    Right to left: $P = (\ip i A Q) \param i $

  \item Sigma.
    By def.
  \item Param.

    Left to right. Assume:
    \begin{itemize}
    \item $a : A$
    \item $b : A\op j a$
    \item $p : A \op j a \op i b $
    \end{itemize}
    We prove $q' : A \op i \CP j {\proj j a} b \op j a \param i  $ with $\CP i a {\CP j b p} \param j \param i$.
    The result is given by $\TO A q'$.

    Right to left: same principle.
  \end{itemize}
  \item Variable.
    By def.
\end{proof}

\subsection{Example: naturals}
Let $N = ∀X. X → (X → X) → X$.
Proving (unary) parametricity for $N$ means that, assuming
\begin{itemize}
\item $f : N$
\item $A : U$
\item $P : A → U$
\item $z : A$
\item $z' : P z$
\item $s : A → A$
\item $s' : (x:A) → P x → P (s x)$
\end{itemize}
we can prove $P (f A z s)$.

Indeed, a proof term is the following:

\[
(f (\ip i A P) \CP i z {z'} \fp i s {s'}) \param i
\]

\section{Presheaf model}

Let \pI{} be the category of finite set of names $I,J,K,…$ and injective
partial function.  (Any morphism $f : I → J$ has a unique decomposition
into a projection map $α : I → I_α$, which is not defined anywhere, and
an injection map $h : I_α ↣ J$.)  For any object $I$ and $ι ∉ I$, we note
$(ι \, 0) : I,ι → I$ the partial identity on $I$.

\begin{tikzpicture}[node distance=4\baselineskip]
  \node              (I)  {$I$};
  \node[below of=I]  (Ia) {$I_α$};
  \node[right of=Ia] (J)  {$J$};

  \draw[->] (I) to node[left] {$α$} (Ia);
  \draw[->] (I) to node[above right] {$f$} (J);
  \draw[to reversed->] (Ia) to node[below] {$h$} (J);
\end{tikzpicture}

For any object $I$, let $\fresh{I}$ be a fresh name: $\fresh{I} ∉ I$.

\bigskip
We call $I$-element any tuple indexed by the subsets of $I$: $(u_J)_{J ⊆ I}$.
An $I$-set is a set of $I$-elements.  For instance, the elements of a
$\{ι,κ\}$-set are of the form $u = (u_∅,u_ι,u_κ,u_{ι,κ})$.
%
If $a,b$ are $I$-elements and $κ ∉ I$, we define the $(I,κ)$-element
$(a ,_κ b)$ as $(a ,_κ b)_J ≔ a_J$ if $κ ∉ J$ and $(a ,_κ b)_{J,κ} ≔ b_J$.
%
Any $(I,ι)$-element can be written $u = (u_J)_{J ⊆ \{I,ι\}} = (u_J)_{J ⊆ I} ∪ (u_{J,ι})_{J ⊆ I}$;
We can therefore define the $I$-elements $u (ι\,0) ≔ (u_J)_{J ⊆ I}$ and $u · ι ≔ (u_{J,ι})_{J ⊆ I}$.
(Hence $u = (u (ι\,0) ,_ι u · ι)$.)

\bigskip
We take the the usual presheaf model of type theory on \pI{} with the
following restrictions:
\begin{enumerate}
  \item for any $I ∈ \pI$, $F(I)$ is a $I$-set, and
  \item for any projection map $α : I → I_α$, the
    map $u ↦ uα$, $F(I) → F(I_α)$ is the projection operation, \ie,
    $uα_J = u_J$ for any $J ⊆ I$.
\end{enumerate}

\bigskip
A context $Γ ⊢_I$ is given by a $J$-set $Γf$ for each map $f : I → J$.
Furthermore the map $ρ ↦ ρα$, $Γf → Γ(fα)$ is the projection operation,
and if $g : J → K$ then the map $ρ ↦ ρg$, $Γf → Γ(fg)$ is such that
$ρ1 = ρ$ and $(ρg)h = ρ(gh)$ for any $h : K → L$.

\medskip
A type $Γ ⊢_I A$ is given by a $J$-set $A(f,ρ)$ for each $f : I → J$ and
$ρ : Γf$.
Furthermore the map $u ↦ uα$, $A(f,ρ) → A(fα,ρα)$ is the projection operation,
and if $g : J → K$ then the map $u ↦ ug$, $A(f,ρ) → A(fg,ρg)$ is such that
$u1 = u$ and $(ug)h = u(gh)$ for any $h : K → L$.

\medskip
A term $Γ ⊢_I a : A$ is given by a family $a(f,ρ) : A(f,ρ)$ such that
$a(f,ρ)g = a(fg,ρg)$ for any $f : I → J$, $ρ : Γf$ and $g : J → K$.

\medskip
If $Γ ⊢_I A$ and $f : I → J$, we define $⟨ρ,u⟩ : (Γ.A)f$ to mean
$ρ ∈ Γf$ and $u ∈ A(f,ρ)$.


\bigskip
\begin{description}
  \item[\sc Universe.]
    Let $f : I → J$, $ρ : Γf$.  $A(f,ρ) : U(f,ρ)$ is
    defined as a $J$-element isomorphic to the naive interpretation,
    a family of sets indexed by
    $g : J \stackrel{α}{→} J_α \stackrel {h}{↣} K$:
    $\left(ωg\right)_{g : J → K} ≅ \left(\left(ω(αh)\right)_{h : J_α ↣ K}\right)_{J_α ⊆ J}$,
    where $ωg = A(fg,ρg)$.
    We define the $K$-element $u g$ as
    $\left(\left(ω(gαh)\right)_{h : K_α ↣ L}\right)_{K_α ⊆ K}$.

    Consider the map $u ↦ uβ$, $U(f,ρ) → U(fβ,ρβ)$.  Let
    $K ⊆ J_β$, and $γ : J \stackrel{β}{→} J_β \stackrel{α}{→} K$ the projection map.
    We have that
    $u_K = \left(ω(γh)\right)_{h : K ↣ L}
         = \left(ω(βαh)\right)_{h : K ↣ L}
         = uβ_K$.

  \item[\sc Pi.]
    Let $f : I → J$, $ρ : Γf$.  An element $w$ of $(Π A B)(f,ρ)$ is
    defined as a $J$-element isomorphic to the naive interpretation, a
    family $λ$ of functions indexed by
    $g : J \stackrel{α}{→} J_α \stackrel {h}{↣} K$:
    $\left(λg\right)_{g : J → K} ≅ \left(\left(λ(αh)\right)_{h : J_α ↣ K}\right)_{J_α ⊆ J}$,
    where
    $$λ g = \prod_{u : A(fg,ρg)} B(fg,⟨ρg,u⟩) $$
    and such that
    $\app{λg} u h = \app{λ(gh)}{uh}$ for $g : J → K$ and $h : K → L$.
    We define the $K$-element $w g$ as
    $\left(\left(λ(gαh)\right)_{h : K_α ↣ L}\right)_{K_α ⊆ K}$.

    Consider the map $w ↦ wβ$, $(Π A B)(f,ρ) → (Π A B)(fβ,ρβ)$.  Let
    $K ⊆ J_β$, and $γ : J \stackrel{β}{→} J_β \stackrel{α}{→} K$ the projection map.
    We have that
    $w_K = \left(λ(γh)\right)_{h : K ↣ L}
         = \left(λ(βαh)\right)_{h : K ↣ L}
         = wβ_K$.

%    Taking $ρ : Γ(ι\,0)$, we get by induction that
%    that the ($I$-)elements of $(Π A B)((ι\,0),ρ)$
%    are those of $(Π (A(ι\,0)) (B(ι\,0)))(1,ρ)$, \ie, of $(Π A B)(ι\,0)(1,ρ)$:
%    $$ \left(\left(\prod_{u : A((ι\,0)αh,ραh)} B((ι\,0)αh,⟨ραh,u⟩)\right)_{h : I_α ↣ K}\right)_{I_α ⊆ I}
%      = \left(\left(\prod_{u : A(ι\,0)(αh,ραh)} B(ι\,0)(αh,⟨ραh,u⟩)\right)_{h : I_α ↣ K}\right)_{I_α ⊆ I}
%    $$
%    If $g : J \stackrel{α}{→} J_α \stackrel {h}{↣} K$, we note $wg$ the
%    function $$\prod_{u : A(fαh,ραh)} B(fαh,⟨ραh,u⟩)$$.

  \item[\sc Out.]
    Let $f : I → J$, $ρ : Γf$.  We need to define the $J$-set $(P \op {ι} a)(f,ρ)$.
    Let $κ = \fresh J$ and $f' : I,ι → J,κ$ such that the following
    diagram commutes:

    \begin{tikzpicture}[node distance=4\baselineskip]
      \node              (Ii) {$I,ι$};
      \node[below of=Ii] (I)  {$I$};
      \node[right of=Ii] (Jk) {$J,κ$};
      \node[below of=Jk] (J)  {$J$};

      \draw[->] (Ii) to node[left]  {$(ι\,0)$} (I);
      \draw[->] (Ii) to node[above] {$f'$}     (Jk);
      \draw[->] (Jk) to node[right] {$(κ\,0)$} (J);
      \draw[->] (I)  to node[below] {$f$}      (J);
    \end{tikzpicture}

    By construction $P(ρ',f')$ is a $(J,κ)$-set for the extension $ρ' ∈ Γf'$ of $ρ$,
    and $af ∈ P(ι\,0)(f,ρ)$ is a $J$-element.
    We define $(P \op {ι} a)(f,ρ) ≔ \{ v \mid (af ,_κ v) ∈ P(ρ,f')\}$.

  \item[\sc In-Pred.]
    Let $f : I,ι → J$, $ρ : Γf$.  We need to define the $J$-set $(\ip {ι} A P)(f,ρ)$.

    \begin{itemize}
      \item If $f$ is not defined on $ι$, we have $f : I,ι \stackrel{(ι\,0)}{→} I \stackrel{g}{→} J$
        and we define $(\ip {ι} A P)(f,ρ) ≔ A(ρ',g)$
        where $ρ' ∈ Γg$ is the restriction of $ρ ∈ Γf$.

      \item Otherwise, there is a $κ ∈ J$ and $g : I → J_κ$ such that
        the following diagram commutes

        \begin{tikzpicture}[node distance=4\baselineskip]
          \node              (Ii) {$I,ι$};
          \node[below of=Ii] (I)  {$I$};
          \node[right of=Ii] (Jk) {$J$};
          \node[below of=Jk] (J)  {$J_κ$};

          \draw[->] (Ii) to node[left]  {$(ι\,0)$} (I);
          \draw[->] (Ii) to node[above] {$f$}      (Jk);
          \draw[->] (Jk) to node[right] {$(κ\,0)$} (J);
          \draw[->] (I)  to node[below] {$g$}      (J);
        \end{tikzpicture}

        We define $(\ip {ι} A P)(f,ρ) ≔ \{ (u ,_κ v) \mid u ∈ A(ρ',g), v ∈ \app{P(ρ',g)}u\}$
        where $ρ' ∈ Γg$ is the restriction of $ρ ∈ Γf$.
    \end{itemize}
\end{description}

\begin{theorem}
  If $Γ ⊢_I a : A$, $f : I → J$, $ρ ∈ Γf$, then $a(f,ρ) ∈ A(f,ρ)$.
\end{theorem}

\begin{theorem}
  If $Γ ⊢_I a : A$ and $Γ ⊢_I b : A$ with $a = b$, then
  $a(f,ρ) = b(f,ρ)$ for any $f : I → J$ and $ρ : Γf$.
\end{theorem}
\begin{proof}~
  [TODO]
  \begin{itemize}
    \item $\app{λt}{u} = t[u]$
    \item $({(\ip i A P)} \op i a)(f,ρ) = (P\,a)(f,ρ)$
  \end{itemize}
\end{proof}


\section{Related Work}


Parametric Models of Type-Theory vs Parametric Type-Theories

Two pieces of work propose parametric models of type-theory \citep{atkey_relationally_2014,krishnaswami_internalizing_2013}, without
integrating parametricity in the syntax of the calculus. This means
that, while certain consequences of parametricity can be made
available to the programmer via constants valid in the model,
parametricity itself is not generically available, as it is in our
calculus our previous work [tt in color].


Various kinds of models.

Our previous work did not offer a denotational semantics, but only
operational ones.  Krishnaswami and Dreyer propose a model based on
Q-PER.  Atkey et al. propose a model based on reflexive graphs.

\bibliographystyle{abbrvnat}
\bibliography{PaperTools/bibtex/jp}

\end{document}
